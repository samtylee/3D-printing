<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Stall App - TEST</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #667eea; min-height: 100vh; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 30px 20px; text-align: center; color: white; }
        .header h1 { font-size: 2.5em; margin-bottom: 5px; }
        .sync-indicator { margin-top: 15px; font-size: 0.9em; }
        .sync-dot { display: inline-block; width: 12px; height: 12px; border-radius: 50%; background: #4caf50; margin-right: 8px; }
        .sync-dot.offline { background: #ff9800; }
        .tabs { display: flex; background: #f8f9fa; border-bottom: 2px solid #ddd; }
        .tab-button { flex: 1; padding: 15px; cursor: pointer; border: none; background: none; font-size: 16px; font-weight: 500; transition: 0.3s; }
        .tab-button.active { background: white; border-bottom: 3px solid #667eea; color: #667eea; }
        .tab-content { display: none; padding: 30px; }
        .tab-content.active { display: block; }
        .section-box { margin-bottom: 20px; padding: 20px; background: #f8f9fa; border-left: 4px solid #667eea; border-radius: 5px; }
        .btn { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        .btn-primary { background: #667eea; color: white; }
        .btn-danger { background: #f5576c; color: white; }
        input { padding: 10px; margin: 5px; border: 1px solid #ddd; border-radius: 3px; font-size: 14px; }
        .team-list { margin: 10px 0; padding: 10px; background: white; border-radius: 3px; min-height: 30px; }
        .team-member { background: #e3f2fd; padding: 10px; margin: 5px 0; border-radius: 3px; display: flex; justify-content: space-between; align-items: center; }
        .mode-toggle { display: flex; gap: 10px; margin-bottom: 20px; }
        .mode-btn { flex: 1; padding: 10px 15px; border: 2px solid #ddd; background: white; cursor: pointer; border-radius: 5px; font-weight: 500; transition: 0.3s; }
        .mode-btn.active { background: #667eea; color: white; border-color: #667eea; }
        .sales-mode { display: none; }
        .sales-mode.active { display: block; }
        .quick-sale-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; }
        .product-btn { padding: 15px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 14px; }
        .product-btn:hover { background: #5568d3; }
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal.hidden { display: none !important; }
        .modal-content { background: white; padding: 30px; border-radius: 10px; text-align: center; min-width: 300px; }
        label { display: block; margin-top: 10px; margin-bottom: 5px; font-weight: 500; }
        select { padding: 10px; margin: 5px; border: 1px solid #ddd; border-radius: 3px; font-size: 14px; }
        textarea { padding: 10px; margin: 5px; border: 1px solid #ddd; border-radius: 3px; font-size: 14px; width: 100%; font-family: Arial; }
    </style>
    <!-- Firebase SDK (compat builds for global namespace) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
</head>
<body>
    <script>console.log('‚úÖ HTML loaded');</script>
    
    <div class="container">
        <header class="header">
            <h1>üé™ Market Stall Tracker</h1>
            <div class="sync-indicator">
                <span class="sync-dot" id="syncStatus"></span>
                <span id="syncText">Connecting...</span>
            </div>
        </header>

        <nav class="tabs">
            <button class="tab-button active" data-tab="setup">Setup</button>
            <button class="tab-button" data-tab="products">Products</button>
            <button class="tab-button" data-tab="sales">Sales</button>
            <button class="tab-button" data-tab="dashboard">Dashboard</button>
            <button class="tab-button" data-tab="reports">Reports</button>
        </nav>

        <!-- Setup Tab -->
        <section id="setup" class="tab-content active">
            <h2>Setup</h2>
            <div class="section-box">
                <h3>Team Members</h3>
                <div id="teamList" class="team-list"></div>
                <input type="text" id="newTeamMember" placeholder="Enter name">
                <button class="btn btn-primary" onclick="addTeamMember()">Add Member</button>
            </div>
            <div class="section-box">
                <h3>Shared Costs</h3>
                <label>Stall Fee (AUD)</label>
                <input type="number" id="stallFee" min="0" step="0.01" value="175">
                <label>Public Liability Insurance (AUD)</label>
                <input type="number" id="insurance" min="0" step="0.01" value="50">
                <label>Square Reader (AUD)</label>
                <input type="number" id="squareReader" min="0" step="0.01" value="50">
                <p><strong>Total Shared Costs: $<span id="totalCosts">275.00</span></strong></p>
                <button class="btn btn-primary" onclick="updateCosts()">Save Costs</button>
            </div>
            <div class="section-box">
                <h3>Utilities</h3>
                <button class="btn btn-primary" onclick="loadDemoData()">Load Demo Data</button>
                <button class="btn btn-danger" onclick="resetData()">Reset Data</button>
            </div>
        </section>

        <!-- Products Tab -->
        <section id="products" class="tab-content">
            <h2>Products</h2>
            <div class="section-box">
                <h3>Add Product</h3>
                <input type="text" id="productName" placeholder="Product name">
                <input type="number" id="productPrice" placeholder="Price" min="0" step="0.01">
                <button class="btn btn-primary" onclick="addProduct()">Add Product</button>
            </div>
            <div class="section-box">
                <h3>Products List</h3>
                <div id="productsList"></div>
            </div>
        </section>

        <!-- Sales Tab -->
        <section id="sales" class="tab-content">
            <h2>Sales</h2>
            <div class="mode-toggle">
                <button class="mode-btn active" data-mode="quick" onclick="switchSalesMode('quick')">‚ö° Quick Sale Mode</button>
                <button class="mode-btn" data-mode="detailed" onclick="switchSalesMode('detailed')">üìã Detailed Entry</button>
            </div>

            <!-- Quick Sale Mode -->
            <div id="quickSaleMode" class="sales-mode active">
                <div class="section-box">
                    <h3>Tap a Product to Sell</h3>
                    <div id="quickSaleButtons" class="quick-sale-grid"></div>
                </div>
                <div id="paymentModal" class="modal hidden">
                    <div class="modal-content">
                        <h3 id="paymentProductName">Product</h3>
                        <p>How was this paid?</p>
                        <button class="btn btn-primary" onclick="recordSale('Cash')">üíµ Cash</button>
                        <button class="btn btn-primary" onclick="recordSale('Card')">üí≥ Card</button>
                        <button class="btn btn-secondary" onclick="closePaymentModal()">Cancel</button>
                    </div>
                </div>
                <div class="section-box">
                    <h3>Quick Actions</h3>
                    <button class="btn btn-secondary" onclick="adjustLastSaleQty(1)">+1</button>
                    <button class="btn btn-secondary" onclick="adjustLastSaleQty(5)">+5</button>
                    <button class="btn btn-danger" onclick="undoLastSale()">‚Ü©Ô∏è Undo</button>
                </div>
                <div class="section-box">
                    <h3>Running Totals</h3>
                    <p><strong>Total Revenue:</strong> $<span id="quickTotalRevenue">0.00</span></p>
                    <p><strong>Cash Sales:</strong> $<span id="quickCashTotal">0.00</span></p>
                    <p><strong>Card Sales:</strong> $<span id="quickCardTotal">0.00</span></p>
                </div>
            </div>

            <!-- Detailed Entry Mode -->
            <div id="detailedSalesMode" class="sales-mode">
                <div class="section-box">
                    <h3>Record a Sale</h3>
                    <label>Product</label>
                    <select id="saleProductSelect">
                        <option value="">-- Select a Product --</option>
                    </select>
                    <label>Quantity</label>
                    <input type="number" id="saleQuantity" min="1" value="1">
                    <label>Price per Unit (AUD)</label>
                    <input type="number" id="saleUnitPrice" min="0" step="0.01" placeholder="e.g., 15.00">
                    <label>Payment Method</label>
                    <select id="salePaymentMethod">
                        <option value="">-- Select --</option>
                        <option value="Cash">üíµ Cash</option>
                        <option value="Card">üí≥ Card</option>
                    </select>
                    <button class="btn btn-primary" onclick="addSaleDetailed()">Add Sale</button>
                </div>
                <div class="section-box">
                    <h3>Sales History</h3>
                    <div id="salesList"></div>
                </div>
            </div>
        </section>

        <!-- Dashboard Tab -->
        <section id="dashboard" class="tab-content">
            <h2>Dashboard</h2>
            <div class="section-box">
                <h3>Key Metrics</h3>
                <p><strong>Total Revenue:</strong> $<span id="dashRevenue">0.00</span></p>
                <p><strong>Total Shared Costs:</strong> $<span id="dashCosts">275.00</span></p>
                <p><strong>Profit After Costs:</strong> $<span id="dashProfit">0.00</span></p>
                <p><strong>Cash Sales:</strong> $<span id="dashCashTotal">0.00</span></p>
                <p><strong>Card Sales:</strong> $<span id="dashCardTotal">0.00</span></p>
                <p><strong>Total Sales Count:</strong> <span id="dashSaleCount">0</span></p>
            </div>
        </section>

        <!-- Reports Tab -->
        <section id="reports" class="tab-content">
            <h2>Reports</h2>
            <div class="section-box">
                <h3>Event Details</h3>
                <label>Event Name</label>
                <input type="text" id="eventName" placeholder="e.g., Glenferrie Festival" value="Glenferrie Festival">
                <label>Event Date</label>
                <input type="date" id="eventDate">
                <label>Notes</label>
                <textarea id="eventNotes" placeholder="Add any notes..." rows="3"></textarea>
                <button class="btn btn-primary" onclick="saveReportMeta()">Save Report</button>
            </div>
            <div class="section-box">
                <h3>Summary Report</h3>
                <div id="reportContent"></div>
                <button class="btn btn-primary" onclick="printReport()">üñ®Ô∏è Print Report</button>
            </div>
        </section>
    </div>

    <script>
        console.log('‚úÖ Script section started');
        
        // Firebase config (project: d-printing-8c673)
        const firebaseConfig = {
            apiKey: "AIzaSyBfUIQlBxfWq-YhvQJt6YIwKEyXG20K8Pg",
            authDomain: "d-printing-8c673.firebaseapp.com",
            databaseURL: "https://d-printing-8c673-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "d-printing-8c673",
            storageBucket: "d-printing-8c673.firebasestorage.app",
            messagingSenderId: "831638904366",
            appId: "1:831638904366:web:a8ecd84d6f9ad7bd7a09bf",
            measurementId: "G-5R6FPS4D9S"
        };

        let firebaseReady = false;
        let db = null;

        try {
            if (typeof firebase !== 'undefined') {
                firebase.initializeApp(firebaseConfig);
                db = firebase.database();
                firebaseReady = true;
                console.log('‚úÖ Firebase initialized');
            } else {
                console.log('Firebase SDK not loaded');
            }
        } catch (e) {
            console.warn('Firebase init error', e);
        }

        let appData = {
            teamMembers: [],
            products: [],
            sales: [],
            costs: {
                stallFee: 175,
                insurance: 50,
                squareReader: 50
            },
            reportMeta: {
                eventName: "Glenferrie Festival",
                eventDate: new Date().toISOString().split('T')[0],
                notes: ""
            },
            currentSalesMode: 'quick',
            pendingProductId: null
        };

        // Local storage helpers
        function saveLocal() {
            try { localStorage.setItem('appData', JSON.stringify(appData)); } catch(e){}
        }
        function loadLocal() {
            try {
                const j = localStorage.getItem('appData');
                if (j) appData = JSON.parse(j);
            } catch(e){}
        }

        // Firebase helpers
        function saveToFirebase() {
            if (!firebaseReady || !db) return;
            try { db.ref('/state').set(appData); } catch(e) { console.warn('saveToFirebase failed', e); }
        }

        function setupFirebaseListeners() {
            if (!firebaseReady || !db) return;
            const ref = db.ref('/state');
            ref.on('value', (snap) => {
                const val = snap.val();
                if (val) {
                    appData = val;
                    saveLocal();
                    renderAll();
                }
            });
            console.log('Firebase listeners attached');
        }

        function updateSyncStatus() {
            const dot = document.getElementById('syncStatus');
            const text = document.getElementById('syncText');
            const online = navigator.onLine && firebaseReady;
            if (online) {
                dot.classList.remove('offline');
                dot.style.background = '#4caf50';
                text.textContent = 'Live Sync ‚úì';
            } else {
                dot.classList.add('offline');
                dot.style.background = '#ff9800';
                text.textContent = firebaseReady ? 'Offline Mode' : 'Local Mode';
            }
        }

        // UI and data functions (mutate appData then save)
        function switchTab(tabName) {
            console.log('Switching to tab:', tabName);
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            const el = document.getElementById(tabName);
            if (el) el.classList.add('active');
            const btn = document.querySelector(`[data-tab="${tabName}"]`);
            if (btn) btn.classList.add('active');
        }

        function addTeamMember() {
            const input = document.getElementById('newTeamMember');
            const name = input.value.trim();
            if (name) {
                appData.teamMembers.push(name);
                input.value = '';
                renderTeamList();
                saveLocal(); saveToFirebase();
            }
        }

        function renderTeamList() {
            const list = document.getElementById('teamList');
            if (!list) return;
            list.innerHTML = appData.teamMembers.map((m, i) => 
                `<div class="team-member">${m} <button class="btn btn-danger" onclick="removeTeamMember(${i})">Remove</button></div>`
            ).join('');
        }

        function removeTeamMember(i) {
            appData.teamMembers.splice(i, 1);
            renderTeamList();
            saveLocal(); saveToFirebase();
        }

        function addProduct() {
            const name = document.getElementById('productName').value.trim();
            const price = parseFloat(document.getElementById('productPrice').value);
            if (name && price > 0) {
                const id = Date.now();
                appData.products.push({ id, name, price });
                document.getElementById('productName').value = '';
                document.getElementById('productPrice').value = '';
                renderProducts(); updateProductSelect();
                saveLocal(); saveToFirebase();
            }
        }

        function renderProducts() {
            const list = document.getElementById('productsList');
            if (!list) return;
            list.innerHTML = appData.products.map(p => 
                `<div class="team-member">${p.name} - $${p.price.toFixed(2)} <button class="btn btn-danger" onclick="removeProduct(${p.id})">Remove</button></div>`
            ).join('');
        }

        function removeProduct(id) {
            appData.products = appData.products.filter(p => p.id !== id);
            renderProducts(); updateProductSelect();
            saveLocal(); saveToFirebase();
        }

        function updateProductSelect() {
            const select = document.getElementById('saleProduct');
            const detailSelect = document.getElementById('saleProductSelect');
            if (!select && !detailSelect) return;
            const current = select?.value || detailSelect?.value;
            const html = '<option>Select product...</option>' + 
                appData.products.map(p => `<option value="${p.id}">${p.name} - $${p.price.toFixed(2)}</option>`).join('');
            if (select) select.innerHTML = html;
            if (detailSelect) detailSelect.innerHTML = '<option value="">-- Select a Product --</option>' + 
                appData.products.map(p => `<option value="${p.id}">${p.name} - $${p.price.toFixed(2)}</option>`).join('');
        }

        function switchSalesMode(mode) {
            appData.currentSalesMode = mode;
            document.querySelectorAll('.sales-mode').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.mode-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(mode === 'quick' ? 'quickSaleMode' : 'detailedSalesMode').classList.add('active');
            document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
            renderQuickSaleButtons();
        }

        function renderQuickSaleButtons() {
            const grid = document.getElementById('quickSaleButtons');
            if (!grid) return;
            grid.innerHTML = appData.products.map(p => 
                `<button class="product-btn" onclick="openPaymentModal(${p.id}, '${p.name}', ${p.price})">${p.name}<br>$${p.price.toFixed(2)}</button>`
            ).join('');
        }

        function openPaymentModal(productId, productName, price) {
            appData.pendingProductId = productId;
            document.getElementById('paymentProductName').textContent = `${productName} - $${price.toFixed(2)}`;
            document.getElementById('paymentModal').classList.remove('hidden');
        }

        function closePaymentModal() {
            document.getElementById('paymentModal').classList.add('hidden');
            appData.pendingProductId = null;
        }

        function recordSale(paymentMethod) {
            if (!appData.pendingProductId) return;
            const product = appData.products.find(p => p.id == appData.pendingProductId);
            if (product) {
                appData.sales.push({ 
                    productId: appData.pendingProductId, 
                    qty: 1, 
                    price: product.price, 
                    amount: product.price,
                    paymentMethod: paymentMethod
                });
                closePaymentModal();
                renderSales(); updateDashboard();
                saveLocal(); saveToFirebase();
            }
        }

        function addSaleDetailed() {
            const productId = document.getElementById('saleProductSelect').value;
            const qty = parseInt(document.getElementById('saleQuantity').value);
            const unitPrice = parseFloat(document.getElementById('saleUnitPrice').value);
            const paymentMethod = document.getElementById('salePaymentMethod').value;
            if (productId && qty > 0 && unitPrice > 0 && paymentMethod) {
                appData.sales.push({ 
                    productId: parseInt(productId), 
                    qty, 
                    price: unitPrice, 
                    amount: qty * unitPrice,
                    paymentMethod: paymentMethod
                });
                document.getElementById('saleQuantity').value = '1';
                document.getElementById('saleUnitPrice').value = '';
                document.getElementById('saleProductSelect').value = '';
                document.getElementById('salePaymentMethod').value = '';
                renderSales(); updateDashboard();
                saveLocal(); saveToFirebase();
            }
        }

        function adjustLastSaleQty(delta) {
            if (appData.sales.length > 0) {
                const last = appData.sales[appData.sales.length - 1];
                last.qty += delta;
                last.amount = last.qty * last.price;
                renderSales(); updateDashboard();
                saveLocal(); saveToFirebase();
            }
        }

        function undoLastSale() {
            if (appData.sales.length > 0) {
                appData.sales.pop();
                renderSales(); updateDashboard();
                saveLocal(); saveToFirebase();
            }
        }

        function renderSales() {
            const list = document.getElementById('salesList');
            if (!list) return;
            list.innerHTML = appData.sales.map((s, i) => {
                const product = appData.products.find(p => p.id == s.productId);
                return `<div class="team-member">${product?.name || 'Unknown'} x${s.qty} = $${s.amount.toFixed(2)} <button class="btn btn-danger" onclick="removeSale(${i})">Remove</button></div>`;
            }).join('');
        }

        function removeSale(i) {
            appData.sales.splice(i, 1);
            renderSales(); updateDashboard();
            saveLocal(); saveToFirebase();
        }

        function updateDashboard() {
            const revenue = appData.sales.reduce((sum, s) => sum + s.amount, 0);
            const costs = appData.costs.stallFee + appData.costs.insurance + appData.costs.squareReader;
            const profit = revenue - costs;
            const cashTotal = appData.sales.filter(s => s.paymentMethod === 'Cash').reduce((sum, s) => sum + s.amount, 0);
            const cardTotal = appData.sales.filter(s => s.paymentMethod === 'Card').reduce((sum, s) => sum + s.amount, 0);
            
            const rEl = document.getElementById('revenue');
            const cEl = document.getElementById('saleCount');
            const dashRev = document.getElementById('dashRevenue');
            const dashCosts = document.getElementById('dashCosts');
            const dashProfit = document.getElementById('dashProfit');
            const dashCash = document.getElementById('dashCashTotal');
            const dashCard = document.getElementById('dashCardTotal');
            const dashCount = document.getElementById('dashSaleCount');
            const quickRev = document.getElementById('quickTotalRevenue');
            const quickCash = document.getElementById('quickCashTotal');
            const quickCard = document.getElementById('quickCardTotal');
            
            if (rEl) rEl.textContent = revenue.toFixed(2);
            if (cEl) cEl.textContent = appData.sales.length;
            if (dashRev) dashRev.textContent = revenue.toFixed(2);
            if (dashCosts) dashCosts.textContent = costs.toFixed(2);
            if (dashProfit) dashProfit.textContent = profit.toFixed(2);
            if (dashCash) dashCash.textContent = cashTotal.toFixed(2);
            if (dashCard) dashCard.textContent = cardTotal.toFixed(2);
            if (dashCount) dashCount.textContent = appData.sales.length;
            if (quickRev) quickRev.textContent = revenue.toFixed(2);
            if (quickCash) quickCash.textContent = cashTotal.toFixed(2);
            if (quickCard) quickCard.textContent = cardTotal.toFixed(2);
        }

        function updateCosts() {
            appData.costs.stallFee = parseFloat(document.getElementById('stallFee').value) || 0;
            appData.costs.insurance = parseFloat(document.getElementById('insurance').value) || 0;
            appData.costs.squareReader = parseFloat(document.getElementById('squareReader').value) || 0;
            const total = appData.costs.stallFee + appData.costs.insurance + appData.costs.squareReader;
            const totalEl = document.getElementById('totalCosts');
            if (totalEl) totalEl.textContent = total.toFixed(2);
            updateDashboard();
            saveLocal(); saveToFirebase();
        }

        function saveReportMeta() {
            appData.reportMeta.eventName = document.getElementById('eventName').value;
            appData.reportMeta.eventDate = document.getElementById('eventDate').value;
            appData.reportMeta.notes = document.getElementById('eventNotes').value;
            updateReportDisplay();
            saveLocal(); saveToFirebase();
        }

        function updateReportDisplay() {
            const revenue = appData.sales.reduce((sum, s) => sum + s.amount, 0);
            const costs = appData.costs.stallFee + appData.costs.insurance + appData.costs.squareReader;
            const profit = revenue - costs;
            const cashTotal = appData.sales.filter(s => s.paymentMethod === 'Cash').reduce((sum, s) => sum + s.amount, 0);
            const cardTotal = appData.sales.filter(s => s.paymentMethod === 'Card').reduce((sum, s) => sum + s.amount, 0);
            
            const html = `
                <p><strong>Event:</strong> ${appData.reportMeta.eventName}</p>
                <p><strong>Date:</strong> ${appData.reportMeta.eventDate}</p>
                <p><strong>Total Revenue:</strong> $${revenue.toFixed(2)}</p>
                <p><strong>Cash Sales:</strong> $${cashTotal.toFixed(2)}</p>
                <p><strong>Card Sales:</strong> $${cardTotal.toFixed(2)}</p>
                <p><strong>Total Costs:</strong> $${costs.toFixed(2)}</p>
                <p><strong>Net Profit:</strong> $${profit.toFixed(2)}</p>
                <p><strong>Total Sales:</strong> ${appData.sales.length}</p>
                <p><strong>Notes:</strong> ${appData.reportMeta.notes || 'None'}</p>
            `;
            const reportEl = document.getElementById('reportContent');
            if (reportEl) reportEl.innerHTML = html;
        }

        function printReport() {
            window.print();
        }

        function loadDemoData() {
            appData.teamMembers = ['Alice', 'Bob', 'Charlie'];
            appData.products = [
                { id: 1, name: 'Dragon', price: 15 },
                { id: 2, name: 'Spinner', price: 8 },
                { id: 3, name: 'Stand', price: 12 }
            ];
            appData.sales = [
                { productId: 1, qty: 2, price: 15, amount: 30, paymentMethod: 'Cash' },
                { productId: 2, qty: 3, price: 8, amount: 24, paymentMethod: 'Card' }
            ];
            appData.costs = { stallFee: 175, insurance: 50, squareReader: 50 };
            appData.reportMeta = {
                eventName: "Glenferrie Festival",
                eventDate: new Date().toISOString().split('T')[0],
                notes: "Demo data loaded"
            };
            renderAll();
            saveLocal(); saveToFirebase();
        }

        function renderAll() {
            renderTeamList(); renderProducts(); updateProductSelect(); renderSales(); updateDashboard();
            renderQuickSaleButtons();
            // Initialize cost inputs
            document.getElementById('stallFee').value = appData.costs.stallFee;
            document.getElementById('insurance').value = appData.costs.insurance;
            document.getElementById('squareReader').value = appData.costs.squareReader;
            updateCosts();
            // Initialize report section
            document.getElementById('eventName').value = appData.reportMeta.eventName;
            document.getElementById('eventDate').value = appData.reportMeta.eventDate;
            document.getElementById('eventNotes').value = appData.reportMeta.notes;
            updateReportDisplay();
        }

        function resetData() {
            if (confirm('Reset all data?')) {
                appData = { teamMembers: [], products: [], sales: [] };
                renderAll();
                saveLocal(); saveToFirebase();
            }
        }

        // Setup event listeners
        console.log('Setting up event listeners...');
        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.addEventListener('click', (e) => {
                switchTab(e.target.getAttribute('data-tab'));
            });
        });

        // Initialize: load local then attach Firebase
        console.log('Initializing app...');
        loadLocal();
        renderAll();
        if (firebaseReady) setupFirebaseListeners();
        updateSyncStatus();
        console.log('‚úÖ App ready!');

        // Listen for online/offline
        window.addEventListener('online', () => { updateSyncStatus(); saveToFirebase(); });
        window.addEventListener('offline', updateSyncStatus);
    </script>
</body>
</html>
